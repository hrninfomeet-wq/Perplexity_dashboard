<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced NSE Trading Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="dashboard-title">NSE Trading Dashboard</h1>
                <div class="datetime-display">
                    <span id="current-date">Loading...</span>
                    <span id="current-time">Loading...</span>
                </div>
            </div>
            
            <!-- NEW: Header middle section for market indices -->
            <div class="header-middle">
                <div class="market-summary">
                    <div class="summary-item">
                        <span class="label">NIFTY 50</span>
                        <span class="value" id="nifty-price">24,346.85</span>
                        <span class="change positive" id="nifty-change">+123.35 (0.40%)</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">BANK NIFTY</span>
                        <span class="value" id="banknifty-price">51,245.06</span>
                        <span class="change negative" id="banknifty-change">-87.34 (-0.05%)</span>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="market-status">
                    <span class="status-indicator mock" id="connection-status">Mock Mode Active</span>
                </div>
                
                <!-- Enhanced: Live updates indicator -->
                <div class="live-updates-indicator">
                    <div class="updates-dot mock" id="updates-dot"></div>
                    <span class="updates-text" id="updates-text">Live Updates</span>
                </div>
                
                <!-- Enhanced: Data source toggle -->
                <div class="data-source-toggle">
                    <div class="toggle-container">
                        <span class="toggle-label">Data Source:</span>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="dataSource" id="mockData" checked>
                                <span class="radio-text">Mock</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="dataSource" id="liveData">
                                <span class="radio-text">Live (API)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced: Market trend summary -->
        <div id="trend-summary" class="flat">
            <div>
                <span class="summary-label">Market Trend:</span>
                <span id="trend-direction" class="trend-sideways">🥱 SIDEWAYS</span>
            </div>
            <div>
                <span class="summary-label">Support:</span>
                <span id="support-value">24,280</span>
            </div>
            <div>
                <span class="summary-label">Resistance:</span>
                <span id="resistance-value">24,420</span>
            </div>
            <div>
                <span class="summary-label">Volume:</span>
                <span id="volume-status">NORMAL</span>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Main Content (70%) -->
        <main class="main-content">
            <!-- Market Indices Section -->
            <section class="section">
                <div class="section-header">
                    <h2>Market Indices</h2>
                    <div class="controls">
                        <button class="btn btn--sm btn--secondary" id="refresh-indices">Refresh</button>
                        <span class="data-timestamp" id="indices-timestamp">Updated: Never</span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="indices-table">
                        <thead>
                            <tr>
                                <th>Index Name</th>
                                <th>Current Price</th>
                                <th>Change</th>
                                <th>Change %</th>
                                <th>Day High</th>
                                <th>Day Low</th>
                                <th>Volume</th>
                            </tr>
                        </thead>
                        <tbody id="indices-tbody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Enhanced: Market Analysis with Sector Heatmap -->
            <section class="section">
                <div class="section-header">
                    <h2>Market Analysis</h2>
                    <span class="data-timestamp" id="sectors-timestamp">Updated: Never</span>
                </div>
                
                <!-- Sector Heatmap -->
                <div class="heatmap-container">
                    <h3>Sector Performance</h3>
                    <div class="sector-grid" id="sector-grid">
                        <!-- Dynamic content -->
                    </div>
                </div>
                
                <!-- Top Gainers and Losers -->
                <div class="gainers-losers-grid">
                    <div class="gainers-container">
                        <h4>Top Gainers</h4>
                        <div class="gainers-list" id="gainers-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    <div class="losers-container">
                        <h4>Top Losers</h4>
                        <div class="losers-list" id="losers-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Enhanced: BTST Stock Scanner -->
            <section class="btst-section">
                <div class="section-header">
                    <h3>BTST Stock Scanner</h3>
                    <div class="controls">
                        <div class="btst-filters">
                            <select class="form-control">
                                <option>All Stocks</option>
                                <option>F&O Only</option>
                                <option>High Volume</option>
                            </select>
                            <select class="form-control">
                                <option>Score > 7</option>
                                <option>Score > 8</option>
                                <option>All Scores</option>
                            </select>
                        </div>
                        <span class="data-timestamp" id="btst-timestamp">Updated: Never</span>
                    </div>
                </div>
                <div class="table-container">
                    <table class="btst-table">
                        <thead>
                            <tr>
                                <th>Stock Name</th>
                                <th>LTP</th>
                                <th>Change %</th>
                                <th>Volume Ratio</th>
                                <th>Technical Signal</th>
                                <th>RSI</th>
                                <th>Price Action</th>
                                <th>BTST Score</th>
                            </tr>
                        </thead>
                        <tbody id="btst-tbody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Sidebar (30%) -->
        <aside class="sidebar">
            <!-- Enhanced: Scalping Opportunities (moved to top) -->
            <section class="scalping-section">
                <div class="section-header">
                    <h3>Scalping Opportunities</h3>
                    <span class="data-timestamp" id="scalping-timestamp">Updated: Never</span>
                </div>
                <div class="table-container">
                    <table class="scalping-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Instrument</th>
                                <th>Type</th>
                                <th>Strike</th>
                                <th>Direction</th>
                                <th>Strategy</th>
                                <th>Probability</th>
                                <th>Status</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody id="scalping-tbody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Trading Alerts -->
            <section class="section alerts-section">
                <div class="section-header">
                    <h3>Trading Alerts</h3>
                    <span class="data-timestamp" id="alerts-timestamp">Updated: Never</span>
                </div>
                <div class="alerts-container" id="alerts-list">
                    <!-- Dynamic content -->
                </div>
            </section>

            <!-- Enhanced: F&O Analysis -->
            <section class="section fno-section">
                <div class="section-header">
                    <h3>F&O Analysis</h3>
                    <span class="data-timestamp" id="fno-timestamp">Updated: Never</span>
                </div>
                
                <div class="fno-metrics">
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-label">PCR</div>
                            <div class="metric-value" id="pcr-value">1.02</div>
                            <div class="metric-description">Put-Call Ratio</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Max Pain</div>
                            <div class="metric-value" id="max-pain">24,300</div>
                            <div class="metric-description">Strike with max OI</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">VIX</div>
                            <div class="metric-value" id="vix-value">13.45</div>
                            <div class="metric-description">Volatility Index</div>
                        </div>
                    </div>
                    
                    <!-- Option Highlights -->
                    <div class="option-highlights">
                        <div class="highlight-item">
                            <span class="option-type call">CE</span>
                            <span class="strike">24400</span>
                            <span class="premium">₹85</span>
                        </div>
                        <div class="highlight-item">
                            <span class="option-type put">PE</span>
                            <span class="strike">24300</span>
                            <span class="premium">₹78</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Enhanced: Settings -->
            <section class="section settings-section">
                <div class="section-header">
                    <h3>Settings</h3>
                </div>
                <div class="settings-content">
                    <div class="setting-item">
                        <label for="refresh-interval">Refresh Interval:</label>
                        <select class="form-control" id="refresh-interval">
                            <option value="1000">1 second</option>
                            <option value="3000">3 seconds</option>
                            <option value="5000" selected>5 seconds</option>
                            <option value="10000">10 seconds</option>
                            <option value="30000">30 seconds</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <button class="btn btn--secondary btn--full-width" id="connect-flattrade">
                            Login to Flattrade
                        </button>
                    </div>
                    
                    <!-- Enhanced: Alert Thresholds will be added here via JavaScript -->
                </div>
            </section>
        </aside>
    </div>

    <!-- Enhanced: Live Data Confirmation Modal -->
    <div class="modal hidden" id="live-confirmation-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Switch to Live Data</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>⚠️ Important:</strong> You are about to switch to live market data mode.</p>
                <ul>
                    <li>✅ Real-time market quotes and analysis</li>
                    <li>✅ Live F&O option chain data</li>
                    <li>✅ Real-time BTST and scalping signals</li>
                    <li>⚠️ Requires Flattrade API authentication</li>
                    <li>⚠️ May have API rate limits</li>
                </ul>
                <p>Do you want to continue?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" id="cancel-live-data">Cancel</button>
                <button class="btn btn--primary" id="connect-live-data">Connect to Live Data</button>
            </div>
        </div>
    </div>

    <!-- Enhanced: Error Modal -->
    <div class="modal hidden" id="error-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="error-modal-title">Connection Error</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="error-message">Failed to establish connection.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" id="use-mock-fallback">Use Mock Data</button>
                <button class="btn btn--primary" id="retry-connection">Retry Connection</button>
            </div>
        </div>
    </div>

    <!-- Enhanced: Loading Overlay -->
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loading-message">Loading...</p>
        </div>
    </div>

    <!-- Enhanced: Additional CSS for F&O Analysis and other features -->
    <style>
        /* F&O Analysis Styles */
        .fno-metrics {
            display: flex;
            flex-direction: column;
            gap: var(--space-16);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-12);
        }
        
        .metric-card {
            background: var(--color-bg-1);
            padding: var(--space-12);
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid var(--color-border);
        }
        
        .metric-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-4);
            font-weight: var(--font-weight-medium);
        }
        
        .metric-value {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
        }
        
        .metric-description {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }
        
        .option-highlights {
            display: flex;
            justify-content: space-between;
            gap: var(--space-12);
        }
        
        .highlight-item {
            display: flex;
            align-items: center;
            gap: var(--space-8);
            padding: var(--space-8) var(--space-12);
            background: var(--color-surface);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            flex: 1;
        }
        
        .option-type {
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
        }
        
        .option-type.call {
            background: rgba(var(--color-success-rgb), 0.1);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-success-rgb), 0.3);
        }
        
        .option-type.put {
            background: rgba(var(--color-error-rgb), 0.1);
            color: var(--color-error);
            border: 1px solid rgba(var(--color-error-rgb), 0.3);
        }
        
        .strike {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
        }
        
        .premium {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-left: auto;
        }
        
        /* BTST Score Styling */
        .btst-score {
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-sm);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
        }
        
        .btst-score.high {
            background: rgba(var(--color-success-rgb), 0.1);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-success-rgb), 0.3);
        }
        
        .btst-score.medium {
            background: rgba(var(--color-warning-rgb), 0.1);
            color: var(--color-warning);
            border: 1px solid rgba(var(--color-warning-rgb), 0.3);
        }
        
        .btst-score.low {
            background: rgba(var(--color-error-rgb), 0.1);
            color: var(--color-error);
            border: 1px solid rgba(var(--color-error-rgb), 0.3);
        }
        
        /* Status Badge */
        .status-badge {
            padding: var(--space-2) var(--space-6);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }
        
        /* Enhanced Alert Items */
        .alert-item {
            background: var(--color-surface);
            border-radius: var(--radius-md);
            padding: var(--space-12);
            margin-bottom: var(--space-8);
            border-left: 3px solid var(--color-primary);
            transition: all var(--duration-fast) var(--ease-standard);
        }
        
        .alert-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .alert-item.buy {
            border-left-color: var(--color-success);
        }
        
        .alert-item.sell {
            border-left-color: var(--color-error);
        }
        
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-8);
        }
        
        .alert-stock {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
        }
        
        .alert-signal {
            padding: var(--space-2) var(--space-6);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
        }
        
        .alert-signal.buy {
            background: rgba(var(--color-success-rgb), 0.1);
            color: var(--color-success);
        }
        
        .alert-signal.sell {
            background: rgba(var(--color-error-rgb), 0.1);
            color: var(--color-error);
        }
        
        .alert-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }
        
        .alert-details > div {
            display: flex;
            justify-content: space-between;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: var(--color-surface);
            padding: var(--space-32);
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-lg);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--color-secondary);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-16);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal Enhancements */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal.hidden {
            display: none;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
        }
        
        .modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            position: relative;
            z-index: 1001;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: var(--space-20);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--color-text);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-2xl);
            cursor: pointer;
            color: var(--color-text-secondary);
            padding: var(--space-4);
            border-radius: var(--radius-sm);
            transition: background-color var(--duration-fast) var(--ease-standard);
        }
        
        .modal-close:hover {
            background: var(--color-secondary);
        }
        
        .modal-body {
            padding: var(--space-20);
        }
        
        .modal-body ul {
            margin: var(--space-16) 0;
            padding-left: var(--space-20);
        }
        
        .modal-body li {
            margin-bottom: var(--space-8);
        }
        
        .modal-footer {
            padding: var(--space-20);
            border-top: 1px solid var(--color-border);
            display: flex;
            gap: var(--space-12);
            justify-content: flex-end;
        }
        
        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            .metric-grid {
                grid-template-columns: 1fr;
            }
            
            .option-highlights {
                flex-direction: column;
            }
            
            .alert-details {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script src="app.js"></script>
</body>
</html>